
###################### Set up directories ############################

mkdir -p mydemo/1
mkdir -p mydemo/2
mkdir -p mydemo/3

##################### Executed by Operator 1 #########################

#### Step 0 #### Generate stub file.

cd mydemo/1
vmni -prot -sid "Session ID" -name "Swedish Election" \
     -nopart 3 -thres 2

#### Step 1 #### Generate private info and protocol info files.

vmni -party -name "Mix-server 1" \
-http http://localhost:8041 \
-hint localhost:4041

cp localProtInfo.xml protInfo1.xml
cp protInfo1.xml ../2/
cp protInfo1.xml ../3/

#### Step 2 #### Merge protocol files and generate public key.

vmni -merge protInfo?.xml
vmn -keygen publicKey

#### Step 3 #### Generate demo ciphertexts (in reality by senders).

vmnd publicKey 100 ciphertexts
cp ciphertexts ../2/
cp ciphertexts ../3/

#### Step 4 #### Mix the ciphertexts.

vmn -mix ciphertexts plaintexts


##################### Executed by Operator 2 #########################

#### Step 0 #### Generate stub file.

cd mydemo/2
vmni -prot -sid "Session ID" -name "Swedish Election" \
     -nopart 3 -thres 2

#### Step 1 #### Generate private info and protocol info files.

vmni -party -name "Mix-server 2" \
-http http://localhost:8042 \
-hint localhost:4042

# Copy protocol info files using out-of-bound channel.
cp localProtInfo.xml protInfo2.xml
cp protInfo2.xml ../1/
cp protInfo2.xml ../3/

#### Step 2 #### Merge protocol files and generate public key.

vmni -merge protInfo?.xml
vmn -keygen publicKey

#### Step 3 #### Wait for demo ciphertexts (generated by Operator 1).

#### Step 4 #### Mix the ciphertexts.

vmn -mix ciphertexts plaintexts


##################### Executed by Operator 3 #########################

#### Step 0 #### Generate stub file.

cd mydemo/3
vmni -prot -sid "Session ID" -name "Swedish Election" \
     -nopart 3 -thres 2

#### Step 1 #### Generate private info and protocol info files.

vmni -party -name "Mix-server 3" \
-http http://localhost:8043 \
-hint localhost:4043

# Copy protocol info files using out-of-bound channel.
cp localProtInfo.xml protInfo3.xml
cp protInfo3.xml ../1/
cp protInfo3.xml ../2/

#### Step 2 #### Merge protocol files and generate public key.

vmni -merge protInfo?.xml
vmn -keygen publicKey

#### Step 3 #### Wait for demo ciphertexts (generated by Operator 1).

#### Step 4 #### Mix the ciphertexts.

vmn -mix ciphertexts plaintexts


##################### Executed by Observer ###########################

# Verify internal consistency of Fiat-Shamir proof.
vmnv protInfo.xml dir/roProof

# Verify internal consistency of Fiat-Shamir proof and correspondence
# with public key, input ciphertexts, and ouput plaintexts.
vmnv protInfo.xml dir/roProof publicKey ciphertexts plaintexts
